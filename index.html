<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cowboys AC Job Breakdown</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    .section { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    .row { display: flex; flex-wrap: wrap; gap: 20px; }
    .col { flex: 1; min-width: 220px; }
  </style>
</head>
<body>

<h2>Cowboys AC â€“ Job Breakdown</h2>

<div class="section">
  <label>Upload HouseCall Pro Invoice (PDF)</label>
  <input type="file" id="invoiceUpload" accept="application/pdf" />
</div>

<div class="section">
  <div class="row">
    <div class="col">
      <label>Technician</label>
      <select id="technician">
        <option>Employee 1</option><option>Employee 2</option><option>Employee 3</option>
        <option>Employee 4</option><option>Employee 5</option>
      </select>
    </div>
    <div class="col"><label>Invoice #</label><input type="text" id="invoice"></div>
    <div class="col"><label>Customer Name</label><input type="text" id="customer"></div>
    <div class="col"><label>Address</label><input type="text" id="address"></div>
    <div class="col"><label>City</label><input type="text" id="city"></div>
    <div class="col"><label>State</label><input type="text" id="state"></div>
    <div class="col"><label>Sold Price</label><input type="number" id="soldPrice" step="0.01"></div>
    <div class="col">
      <label>Payment Method</label>
      <select id="paymentMethod">
        <option value="0">Cash (0%)</option>
        <option value="0">Financed (0%)</option>
        <option value="0.033">Credit Card (3.3%)</option>
      </select>
    </div>
  </div>
</div>

<script>
document.getElementById('invoiceUpload').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function() {
    const typedarray = new Uint8Array(this.result);
    pdfjsLib.getDocument({ data: typedarray }).promise.then(pdf => {
      pdf.getPage(1).then(page => {
        page.getTextContent().then(content => {
          const text = content.items.map(item => item.str).join(' ');
          
          const find = (pattern) => (text.match(pattern) || [])[1] || '';

          document.getElementById('invoice').value = find(/INVOICE #(\d+)/i);
          document.getElementById('customer').value = find(/Customer Name ([A-Z][a-z]+ [A-Z][a-z]+)/);
          document.getElementById('soldPrice').value = find(/Invoice Amount \\$([\\d,\\.]+)/)?.replace(/,/g, '') || '';

          const addressMatch = text.match(/\\d+\\s+[^,]+Drive|\\d+\\s+[^,]+Street|\\d+\\s+[^,]+Rd/i);
          if (addressMatch) document.getElementById('address').value = addressMatch[0];

          const cityStateMatch = text.match(/San Antonio,\\s*TX/i);
          if (cityStateMatch) {
            document.getElementById('city').value = 'San Antonio';
            document.getElementById('state').value = 'TX';
          }

          if (text.includes('Service Finance')) {
            document.getElementById('paymentMethod').value = '0'; // Financed
          } else if (text.includes('Credit Card')) {
            document.getElementById('paymentMethod').value = '0.033';
          }
        });
      });
    });
  };
  reader.readAsArrayBuffer(file);
});
</script>

</body>
</html>
